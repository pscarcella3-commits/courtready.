<div id="workout-player" class="view" style="background: #000; position: fixed; inset: 0; z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
    <button onclick="closeWorkout()" style="position: absolute; top: 50px; right: 20px; background: none; border: none; color: white;"><i data-lucide="x"></i></button>
    
    <div id="player-category" style="color: var(--neon); font-size: 12px; font-weight: 800; letter-spacing: 2px;">STAMINA FOCUS</div>
    <h2 id="player-ex-title" style="font-size: 38px; font-weight: 900; margin: 10px 0; text-align: center; text-transform: uppercase;">LATERAL SKATERS</h2>
    
    <div class="video-container" style="width: 100%; height: 45vh; border: 2px solid var(--neon); box-shadow: 0 0 20px rgba(212,255,0,0.2);">
        <div id="animation-3d-placeholder" style="color: #222;">
            <i data-lucide="play" size="60"></i>
        </div>
    </div>

    <div id="timer-display" style="font-size: 80px; font-weight: 900; margin: 30px 0; font-variant-numeric: tabular-nums;">00:40</div>
    
    <div style="width: 100%; background: #222; height: 10px; border-radius: 5px; overflow: hidden;">
        <div id="timer-progress" style="width: 100%; height: 100%; background: var(--neon); transition: linear 1s;"></div>
    </div>

    <div style="margin-top: 40px; display: flex; gap: 20px;">
        <button class="choice-btn" style="border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;"><i data-lucide="skip-back"></i></button>
        <button id="play-pause-btn" class="btn-neon" style="width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center;"><i data-lucide="pause"></i></button>
        <button class="choice-btn" style="border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;"><i data-lucide="skip-forward"></i></button>
    </div>
</div>

<script>
    // LOGICA DEL TIMER E VOCE COACH
    let timerInterval;
    let timeLeft = 40;

    function startWorkout(exercises) {
        document.getElementById('workout-player').style.display = 'flex';
        playCoachVoice("Iniziamo l'allenamento. Primo esercizio: " + exercises[0].t);
        runTimer();
    }

    function runTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer-display').innerText = "00:" + (timeLeft < 10 ? "0" : "") + timeLeft;
            document.getElementById('timer-progress').style.width = (timeLeft / 40 * 100) + "%";
            
            if(timeLeft === 3) playCoachVoice("3... 2... 1... Pausa!");
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                // Passa al prossimo esercizio o riposo
            }
        }, 1000);
    }

    function playCoachVoice(text) {
        // Usa la sintesi vocale del telefono
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'it-IT';
        msg.rate = 0.9;
        window.speechSynthesis.speak(msg);
    }

    function closeWorkout() {
        clearInterval(timerInterval);
        window.speechSynthesis.cancel();
        document.getElementById('workout-player').style.display = 'none';
    }
</script>
